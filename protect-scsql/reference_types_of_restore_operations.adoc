---
permalink: protect-scsql/reference_types_of_restore_operations.html 
sidebar: sidebar 
keywords: SnapCenter Plug-in for SQL Server 
summary: 您可以使用 SnapCenter 对 SQL Server 资源执行不同类型的还原操作。 
---
= 还原操作的类型
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以使用 SnapCenter 对 SQL Server 资源执行不同类型的还原操作。

* 即时还原
* 还原到上一时间点


在以下情况下，您可以在最短时间内还原或还原到上一时间点：

* 从 SnapMirror 或 SnapVault 二级存储还原
* 还原到备用路径（位置）



NOTE: SnapCenter 不支持基于卷的 SnapRestore 。



== 恢复时间最长为分钟

在最新的还原操作（默认情况下处于选中状态）中，数据库将恢复到故障点。SnapCenter 通过执行以下顺序来实现此目的：

. 在还原数据库之前，备份最后一个活动事务日志。
. 从您选择的完整数据库备份还原数据库。
. 应用未提交到数据库的所有事务日志（包括从创建备份到最新时间的备份中的事务日志）。
+
事务日志将提前移动并应用于任何选定数据库。



实时还原操作需要一组连续的事务日志。

由于 SnapCenter 无法从日志传送备份文件中还原 SQL Server 数据库事务日志（通过日志传送，您可以自动将事务日志备份从主服务器实例上的主数据库发送到不同二级服务器实例上的一个或多个二级数据库）， 您无法从事务日志备份执行最新的还原操作。因此，您应使用 SnapCenter 备份 SQL Server 数据库事务日志文件。

如果您不需要为所有备份保留最新的还原功能，则可以通过备份策略配置系统的事务日志备份保留。



== 最新还原操作示例

假设您每天中午和星期三下午 4 ： 00 运行 SQL Server 备份您需要从备份中还原。由于某种原因，星期三中午的备份验证失败，因此您决定从星期二中午的备份还原。之后，如果还原了备份，则所有事务日志都会前移并应用于还原的数据库，从创建星期二备份时未提交的日志开始，然后继续执行星期三下午 4 ： 00 写入的最新事务日志（如果备份了事务日志）。



== 还原到上一时间点

在时间点还原操作中，数据库只会还原到过去的特定时间。在以下还原情况下会执行时间点还原操作：

* 数据库将在备份的事务日志中还原到给定时间。
* 此时将还原数据库，并且只会对其应用一小部分已备份的事务日志。



NOTE: 将数据库还原到某个时间点会导致新的恢复路径。

下图显示了执行时间点还原操作时的问题：

image::../media/point_in_time_recovery_path.gif[还原到上一时间点]

在该映像中，恢复路径 1 由一个完整备份和多个事务日志备份组成。将数据库还原到某个时间点。在时间点还原操作之后会创建新的事务日志备份，从而导致恢复路径 2 。创建新的事务日志备份时，不会创建新的完整备份。由于数据损坏或其他问题，在创建新的完整备份之前，您无法还原当前数据库。此外，无法将在恢复路径 2 中创建的事务日志应用于属于恢复路径 1 的完整备份。

如果应用事务日志备份，则还可以指定要停止应用已备份事务的特定日期和时间。为此，您需要指定可用范围内的日期和时间， SnapCenter 将删除此时间点之前未提交的任何事务。您可以使用此方法将数据库还原到发生损坏之前的某个时间点，或者从意外的数据库或表删除中恢复。



== 时间点还原操作示例

假设您在午夜进行一次完整数据库备份，并每小时进行一次事务日志备份。数据库在上午 9 ： 45 崩溃，但您仍会备份故障数据库的事务日志。您可以从以下时间点还原方案中进行选择：

* 还原午夜创建的完整数据库备份，并接受此后丢失的数据库更改。（选项：无）
* 还原完整的数据库备份并应用所有事务日志备份，直到上午 9 ： 45（选项：登录到）
* 还原完整的数据库备份并应用事务日志备份，指定要从最后一组事务日志备份中还原事务的时间。（选项：按特定时间）


在这种情况下，您将计算报告特定错误的日期和时间。在指定日期和时间之前未提交的任何事务都会被删除。

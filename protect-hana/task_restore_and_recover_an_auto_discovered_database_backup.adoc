---
permalink: protect-hana/task_restore_and_recover_an_auto_discovered_database_backup.html 
sidebar: sidebar 
keywords: SnapCenter Plug-in for SAP HANA Database 
summary: 您可以使用 SnapCenter 从一个或多个备份还原和恢复数据。 
---
= 还原和恢复自动发现的数据库备份
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以使用 SnapCenter 从一个或多个备份还原和恢复数据。

.开始之前
* 您必须已备份资源或资源组。
* 您必须已取消要还原的资源或资源组当前正在进行的任何备份操作。
* 对于还原前、还原后、挂载和卸载命令、您应通过以下路径检查这些命令是否位于插件主机上的命令列表中：
+
对于Windows：_C：\Program Files\NetApp\SnapCenter\SnapCenter Plug-in Creator\etc\allowed_commands_list.txt

+
对于Linux：/var/opt/snapcenter/scC/allowed_commands_list.txt

+

NOTE: 如果命令列表中不存在这些命令、则操作将失败。



.关于此任务
* 无法从 SnapCenter 还原基于文件的备份副本。
* 升级到 SnapCenter 4.3 后，可以还原在 SnapCenter 4.2 中创建的备份，但无法恢复。您必须使用 SnapCenter 外部的 HANA Studio 或 HANA 恢复脚本恢复在 SnapCenter 4.2 中创建的备份。
* 对于ONTAP 9.12.1及更低版本、在还原过程中从SnapLock存储快照创建的克隆将继承SnapLock存储到期时间。存储管理员应在SnapLock到期时间后手动清理克隆。
* 对于SnapMirror活动同步还原操作、您必须从主位置选择备份。


.步骤
. 在左侧导航窗格中，单击 * 资源 * ，然后从列表中选择相应的插件。
. 在资源页面中，根据资源类型从 * 视图 * 下拉列表中筛选资源。
+
此时将显示资源以及类型，主机，关联的资源组和策略以及状态。

+

NOTE: 虽然备份可能针对某个资源组，但在还原时，您必须选择要还原的各个资源。

+
如果资源未受保护， "`不受保护` " 将显示在整体状态列中。这可能意味着资源不受保护，或者资源由其他用户备份。

. 选择资源，或选择一个资源组，然后选择该组中的一个资源。
+
此时将显示资源拓扑页面。

. 在管理副本视图中，从主存储系统或二级（镜像或存储）存储系统中选择 * 备份 * 。
. 在主备份表中，选择要从中还原的备份，然后单击 *image:../media/restore_icon.gif["还原图标"]*
+
image::../media/restoring_resource.gif[还原资源]

. 在还原范围页面中，选择 * 完成资源 * 以还原 SAP HANA 数据库的已配置数据卷。
+

NOTE: 您可以选择 * 完整资源 * （使用或不使用 * 卷还原 * ）或 * 租户数据库 * 。

+
如果用户选择 * 租户数据库 * 或 * 完整还原 * 选项，则 SnapCenter 服务器不支持对多个租户执行恢复操作。您必须使用 HANA Studio 或 HANA python 脚本执行恢复操作。

+
.. 如果要还原整个卷，请选择 * 卷还原 * 。
+
此选项可用于在 NFS 环境中的 SnapCenter 4.3 中进行的备份。

+
如果此资源包含卷或qtrees、则在为此类卷或qtrees选择要还原的Snapshot之后创建的Snapshot将被删除、并且无法恢复。此外，如果任何其他资源托管在同一个卷或 qtree 上，则该资源也会被删除。如果选择了 * 使用 * 卷还原 * 选项完成资源 * ，则此选项适用。

.. 选择 * 租户数据库 * 。
+
此选项仅适用于 MDC 资源。

+
在执行还原操作之前，请确保停止租户数据库。

+
如果选择 * 租户数据库 * 选项，则必须使用 HANA Studio 或 SnapCenter 外部的 HANA 恢复脚本执行恢复操作。



. 在恢复范围页面中，选择以下选项之一：
+
|===
| 如果您 ... | 执行此操作 ... 


 a| 
希望尽可能接近当前时间进行恢复
 a| 
选择 * 恢复到最新状态 * 。对于单个容器资源，请指定一个或多个日志和目录备份位置。

对于多租户数据库容器（ MDC ）资源，请指定一个或多个日志备份位置以及备份目录位置。

对于 MDC 资源，此路径应同时包含系统数据库日志和租户数据库日志。



 a| 
希望恢复到指定时间点
 a| 
选择 * 恢复到时间点 * 。

.. 选择时区。
+
默认情况下，浏览器时区已填充。

+
选定时区以及输入时间将转换为绝对 GMT 。

.. 输入日期和时间。例如， HANA Linux 主机位于加利福尼亚州的森尼韦尔，而用户位于罗利， NC 正在将日志恢复到 SnapCenter 。
+
这两个位置之间的时间差为 3 小时，由于用户已从北卡罗来纳州罗利登录，因此将在图形用户界面中选择的默认浏览器时区为 GMT-04 ： 00 。

+
如果用户要恢复到 CA 的 5 a.m .Sunnyvale ，则必须将浏览器时区设置为 HANA Linux 主机时区，即 GMT-07 ： 00 ，并将日期和时间指定为早上 5 ： 00

+
对于单个容器资源，请指定一个或多个日志和目录备份位置。

+
对于 MDC 资源，指定一个或多个日志备份位置以及备份目录位置。

+
对于 MDC 资源，此路径应同时包含系统数据库日志和租户数据库日志。





 a| 
希望恢复到特定的数据备份
 a| 
选择 * 恢复到指定的数据备份 * 。



 a| 
不希望恢复
 a| 
选择 * 无恢复 * 。您必须从 HANA Studio 手动执行恢复操作。

|===
+
您只能恢复升级到 SnapCenter 4.3 后所做的备份，前提是主机和插件都升级到 SnapCenter 4.3 ，并且在将资源转换或发现为自动发现的资源后选择还原的备份。

. 在操作前页面中，输入要在执行还原作业之前运行的还原前和卸载命令。
+
对于自动发现的资源，不能使用 unmount 命令。

. 在操作后页面中，输入要在执行还原作业后运行的 mount 和 post restore 命令。
+
自动发现的资源不能使用挂载命令。

+

NOTE: 对于用于静宿、快照和取消静宿操作的前处理命令和后处理命令、您应从Linux的/opt/snapcenter/snapenter/scC/ALLOWED_commands.config_路径和Windows的_C：\Program Files\NetApp\SnapCenter\Snapcenter Plug-in Creer\ETC\ALLOWED_commands_list.txt检查这些命令是否位于插件主机上的命令列表中。

. 在通知页面的 * 电子邮件首选项 * 下拉列表中，选择要发送电子邮件的场景。
+
您还必须指定发件人和收件人电子邮件地址以及电子邮件主题。此外，还必须在 * 设置 * > * 全局设置 * 页面上配置 SMTP 。

. 查看摘要，然后单击 * 完成 * 。
. 单击 * 监控 * > * 作业 * 以监控操作进度。

